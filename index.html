<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Connect AI | MELIORO Systems</title>
    
    <!-- Styly -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="settings-styles.css">
    <link rel="stylesheet" href="wizard-styles.css">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-content">
                <h1><a href="#" onclick="location.reload(); return false;" class="header-logo-link">My Connect AI</a></h1>
                <div class="header-subtitle">Hybridn√≠ AI Connect syst√©m je p≈ôipraven k pou≈æit√≠</div>
            </div>
            <div class="header-buttons">
                <button class="index-button" onclick="uiManager.showWelcomeScreen()" title="Zpƒõt na √∫vodn√≠ stranu">
                    Index
                </button>
                <div class="dropdown">
                    <button class="menu-button" onclick="uiManager.toggleMainMenu()">
                        Menu
                    </button>
                    <div class="dropdown-content" id="mainMenu">
                        <button class="dropdown-item" onclick="uiManager.showSystemHelp(); uiManager.closeMainMenu();">
                            Jak syst√©m funguje
                        </button>
                        <button class="dropdown-item" onclick="uiManager.showDataProtection(); uiManager.closeMainMenu();">
                            Ochrana dat
                        </button>
                        <button class="dropdown-item" onclick="refreshData(); uiManager.closeMainMenu();">
                            Obnovit data
                        </button>
                        <button class="dropdown-item" onclick="runDiagnosticsManual(); uiManager.closeMainMenu();">
                            Diagnostika
                        </button>
                        <button class="dropdown-item" onclick="settingsManager.toggle(); uiManager.closeMainMenu();">
                            Nastaven√≠
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NASTAVEN√ç PANEL -->
        <div id="settings-panel" class="settings-panel" style="display: none;">
            <div class="settings-title">Nastaven√≠ syst√©mu</div>
            
            <!-- BLOK: AI MODELY -->
            <div class="settings-block">
                <div class="block-title">ü§ñ AI Modely</div>
                <div class="block-description">Vyberte a nastavte AI model pro komunikaci</div>
                
                <div class="settings-section">
                    <label>Zvolen√Ω AI model</label>
                    <select id="ai-model-select" onchange="settingsManager.updateAIModelDisplay()">
                        <option value="openai">OpenAI (ChatGPT)</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="claude">Anthropic Claude</option>
                    </select>
                    <small>Vyberte preferovan√Ω AI model pro komunikaci</small>
                </div>
                
                <!-- OpenAI nastaven√≠ -->
                <div id="openai-settings" class="ai-model-settings">
                    <div class="settings-section">
                        <label for="openai-key">OpenAI API kl√≠ƒç</label>
                        <div class="input-group">
                            <input type="password" id="openai-key" placeholder="sk-...">
                            <button onclick="if(uiManager) uiManager.toggleVisibility('openai-key')" class="toggle-btn">Zobrazit</button>
                        </div>
                        <small>Z√≠skejte na <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></small>
                    </div>
                </div>
                
                <!-- Gemini nastaven√≠ -->
                <div id="gemini-settings" class="ai-model-settings" style="display: none;">
                    <div class="settings-section">
                        <label for="gemini-key">Google Gemini API kl√≠ƒç</label>
                        <div class="input-group">
                            <input type="password" id="gemini-key" placeholder="AIza...">
                            <button onclick="if(uiManager) uiManager.toggleVisibility('gemini-key')" class="toggle-btn">Zobrazit</button>
                        </div>
                        <small>Z√≠skejte na <a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com</a></small>
                    </div>
                </div>
                
                <!-- Claude nastaven√≠ -->
                <div id="claude-settings" class="ai-model-settings" style="display: none;">
                    <div class="settings-section">
                        <label for="claude-key">Anthropic Claude API kl√≠ƒç</label>
                        <div class="input-group">
                            <input type="password" id="claude-key" placeholder="sk-ant-...">
                            <button onclick="if(uiManager) uiManager.toggleVisibility('claude-key')" class="toggle-btn">Zobrazit</button>
                        </div>
                        <small>Z√≠skejte na <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></small>
                    </div>
                </div>
            </div>
            
            <!-- BLOK: APLIKACE -->
            <div class="settings-block">
                <div class="block-title">üìä P≈ôipojen√© aplikace</div>
                <div class="block-description">Nastaven√≠ p≈ôipojen√≠ k va≈°im datov√Ωm zdroj≈Øm</div>
                
                <!-- Tabidoo -->
                <div class="app-connector">
                    <div class="app-connector-header">
                        <div class="app-connector-info">
                            <strong>Tabidoo CRM</strong>
                            <span class="app-connector-status" id="tabidoo-status">Nep≈ôipojeno</span>
                        </div>
                        <button class="app-connector-toggle" onclick="if(uiManager) uiManager.toggleAppConnector('tabidoo')">Nastavit</button>
                    </div>
                    
                    <div id="tabidoo-connector" class="app-connector-settings" style="display: none;">
                        <div class="settings-section">
                            <label for="tabidoo-app-id">App ID</label>
                            <input type="text" id="tabidoo-app-id" placeholder="CRM Start">
                            <small>N√°zev va≈°√≠ aplikace v Tabidoo</small>
                        </div>
                        
                        <div class="settings-section">
                            <label for="tabidoo-token">API Token</label>
                            <div class="input-group">
                                <input type="password" id="tabidoo-token" placeholder="eyJ...">
                                <button onclick="if(uiManager) uiManager.toggleVisibility('tabidoo-token')" class="toggle-btn">Zobrazit</button>
                            </div>
                            <small>Najdete v Tabidoo ‚Üí Nastaven√≠ ‚Üí API</small>
                        </div>
                    </div>
                </div>
                
                <!-- P≈ôipraveno pro dal≈°√≠ aplikace -->
                <div class="app-connector future-connector">
                    <div class="app-connector-header">
                        <div class="app-connector-info">
                            <strong>Dal≈°√≠ aplikace</strong>
                            <span class="app-connector-status">P≈ôipravujeme</span>
                        </div>
                        <button class="app-connector-toggle" disabled>Brzy</button>
                    </div>
                </div>
            </div>
            
            <!-- BLOK: OBECN√â NASTAVEN√ç -->
            <div class="settings-block">
                <div class="block-title">‚öôÔ∏è Obecn√© nastaven√≠</div>
                <div class="block-description">Vzhled a spr√°va konfigurace</div>
                
                <div class="settings-section">
                    <label>Barevn√© sch√©ma</label>
                    <div class="theme-selector">
                        <div class="theme-option theme-claude active" onclick="uiManager.setTheme('claude')" title="Claude (v√Ωchoz√≠)"></div>
                        <div class="theme-option theme-google" onclick="uiManager.setTheme('google')" title="Google"></div>
                        <div class="theme-option theme-replit" onclick="uiManager.setTheme('replit')" title="Replit"></div>
                    </div>
                    <small>Vyberte barevn√© sch√©ma rozhran√≠</small>
                </div>
                
                <div class="settings-section">
                    <label>Spr√°va konfigurace</label>
                    <div class="config-actions">
                        <button onclick="exportConfig()" class="config-btn">
                            üì§ Export konfigurace
                        </button>
                        <button onclick="importConfig()" class="config-btn">
                            üì• Import konfigurace
                        </button>
                        <button onclick="startSetupWizard(); settingsManager.close();" class="config-btn">
                            üßô‚Äç‚ôÇÔ∏è Pr≈Øvodce nastaven√≠m
                        </button>
                        <button onclick="settingsManager.clearAllData()" class="config-btn danger">
                            üóëÔ∏è Vymazat v≈°e
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="settings-actions">
                <button onclick="settingsManager.save()" class="primary-btn">Ulo≈æit nastaven√≠</button>
                <button onclick="settingsManager.close()" class="secondary-btn">Zru≈°it</button>
            </div>
            
            <div class="security-info">
                V≈°echny API kl√≠ƒçe jsou ≈°ifrov√°ny a ukl√°d√°ny pouze lok√°lnƒõ ve va≈°em prohl√≠≈æeƒçi.
            </div>
        </div>
        
        <div id="embeddings-status" class="embeddings-status" style="display: none;">
            <span id="embeddings-text">Vytv√°≈ô√≠m vyhled√°vac√≠ index...</span>
            <div class="progress-bar">
                <div id="embeddings-progress" class="progress-fill"></div>
            </div>
        </div>
        
        <div id="chat-messages" class="chat-messages">
            <div class="welcome-container">
                <div class="example-queries" id="example-queries">
                    <!-- P≈ô√≠klady budou naƒçteny dynamicky -->
                </div>
            </div>
        </div>
        
        <div class="chat-input-area" id="chat-input-area">
            <textarea id="chat-input" class="chat-input" placeholder="Zeptejte se na cokoliv o va≈°ich datech..." rows="1"></textarea>
            <button id="send-button" class="send-button" onclick="sendMessage()">
                Odeslat
            </button>
        </div>
        
        <!-- PATIƒåKA -->
        <div class="app-footer">
            <div class="footer-content">
                <span class="footer-text">Powered by <a href="http://melioro.cz" target="_blank" rel="noopener noreferrer" class="footer-link"><strong>MELIORO Systems</strong></a></span>
                <span class="footer-domain">myconnectai.online</span>
            </div>
        </div>
    </div>

    <!-- SKRIPTY - Modul√°rn√≠ struktura v spr√°vn√©m po≈ôad√≠ -->
    
    <!-- 1. Z√°kladn√≠ moduly -->
    <script src="security.js"></script>
    <script src="config.js"></script>
    
    <!-- 2. Nov√© specializovan√© moduly -->
    <script src="ai-models.js"></script>
    <script src="app-connectors.js"></script>
    <script src="ui-manager.js"></script>
    <script src="settings-manager.js"></script>
    
    <!-- 3. Funkƒçn√≠ moduly -->
    <script src="display.js"></script>
    <script src="data-loader.js"></script>
    <script src="local-search.js"></script>
    <script src="query-processor.js"></script>
    
    <!-- 4. Wizard moduly -->
    <script src="setup-wizard.js"></script>
    <script src="wizard-integration.js"></script>
    
    <!-- 5. Hlavn√≠ aplikaƒçn√≠ logika -->
    <script src="main.js"></script>
    
    <!-- Kompatibiln√≠ funkce a inicializace -->
    <script>
        // Kompatibiln√≠ funkce pro existuj√≠c√≠ k√≥d
        function refreshData() {
            if (!confirm('Opravdu chcete znovu naƒç√≠st data?')) return;
            
            // Vymazat cache
            if (typeof CONFIG !== 'undefined' && CONFIG.CACHE) {
                localStorage.removeItem(CONFIG.CACHE.DATA_KEY);
                localStorage.removeItem(CONFIG.CACHE.DATA_TIMESTAMP_KEY);
            }
            
            location.reload();
        }
        
        function runDiagnosticsManual() {
            if (typeof CONFIG !== 'undefined' && CONFIG.CACHE && CONFIG.CACHE.DIAGNOSTICS_KEY) {
                localStorage.removeItem(CONFIG.CACHE.DIAGNOSTICS_KEY);
            }
            location.reload();
        }
        
        function exportConfig() {
            if (settingsManager) {
                const config = settingsManager.exportConfiguration();
                const exportKey = prompt('Zadejte heslo pro export (zapamatujte si ho):');
                if (!exportKey) return;
                
                const encrypted = security.encrypt(JSON.stringify(config), exportKey);
                
                const blob = new Blob([encrypted], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `myconnectai-config-${Date.now()}.enc`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        function importConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.enc';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const encrypted = await file.text();
                const exportKey = prompt('Zadejte heslo pro import:');
                if (!exportKey) return;
                
                try {
                    const decrypted = security.decrypt(encrypted, exportKey);
                    const config = JSON.parse(decrypted);
                    
                    if (settingsManager) {
                        await settingsManager.importConfiguration(config);
                        alert('Konfigurace √∫spƒõ≈°nƒõ importov√°na!');
                        location.reload();
                    }
                } catch (error) {
                    alert('Chyba p≈ôi importu: Nespr√°vn√© heslo nebo po≈°kozen√Ω soubor');
                }
            };
            
            input.click();
        }
        
        function startSetupWizard() {
            if (typeof setupWizard !== 'undefined' && setupWizard.start) {
                setupWizard.start();
            } else {
                console.error('Setup wizard not available');
                alert('Pr≈Øvodce nastaven√≠m nen√≠ dostupn√Ω. Zkuste obnovit str√°nku.');
            }
        }
        
        function cancelSetupWizard() {
            if (confirm('Opravdu chcete zru≈°it pr≈Øvodce nastaven√≠m?')) {
                sessionStorage.removeItem('wizardStartedFromSettings');
                if (uiManager) {
                    uiManager.showWelcomeScreen();
                } else {
                    location.reload();
                }
            }
        }
        
        // Zachov√°n√≠ kompatibility s existuj√≠c√≠m k√≥dem
        window.toggleSettings = () => settingsManager?.toggle();
        window.saveSettings = () => settingsManager?.save();
        window.showWelcomeScreen = () => uiManager?.showWelcomeScreen();
        window.showSystemHelp = () => uiManager?.showSystemHelp();
        window.showDataProtection = () => uiManager?.showDataProtection();
        window.addMessage = (...args) => uiManager?.addMessage(...args);
        window.addDiagnosticMessage = (...args) => uiManager?.addDiagnosticMessage(...args);
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.matches('.menu-button') && !event.target.closest('.dropdown')) {
                const dropdowns = document.getElementsByClassName('dropdown-content');
                for (let dropdown of dropdowns) {
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                }
            }
        });
        
        console.log('üöÄ My Connect AI - Modular structure loaded');
    </script>
</body>
</html>        // === ENHANCED LOAD CONFIG ===
        function loadConfig() {
            APP_CONFIG.OPENAI_API_KEY = security.loadSecure('openai_key') || '';
            APP_CONFIG.GEMINI_API_KEY = security.loadSecure('gemini_key') || '';
            APP_CONFIG.CLAUDE_API_KEY = security.loadSecure('claude_key') || '';
            APP_CONFIG.TABIDOO_API_TOKEN = security.loadSecure('tabidoo_token') || '';
            APP_CONFIG.TABIDOO_APP_ID = security.loadSecure('tabidoo_app_id') || '';
            APP_CONFIG.SELECTED_AI_MODEL = localStorage.getItem('selected_ai_model') || 'openai';
            
            console.log('Config loaded:', {
                hasOpenAI: !!APP_CONFIG.OPENAI_API_KEY,
                hasGemini: !!APP_CONFIG.GEMINI_API_KEY,
                hasClaude: !!APP_CONFIG.CLAUDE_API_KEY,
                hasTabidoo: !!APP_CONFIG.TABIDOO_API_TOKEN,
                hasAppId: !!APP_CONFIG.TABIDOO_APP_ID,
                selectedAI: APP_CONFIG.SELECTED_AI_MODEL
            });
        }
        
        // === HELPER FUNCTIONS ===<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Connect AI | MELIORO Systems</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="wizard-styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-content">
                <h1><a href="#" onclick="location.reload(); return false;" class="header-logo-link">My Connect AI</a></h1>
                <div class="header-subtitle">Hybridn√≠ AI Connect syst√©m je p≈ôipraven k pou≈æit√≠</div>
            </div>
            <div class="header-buttons">
                <button class="index-button" onclick="showWelcomeScreen()" title="Zpƒõt na √∫vodn√≠ stranu">
                    Index
                </button>
                <div class="dropdown">
                    <button class="menu-button" onclick="toggleMainMenu()">
                        Menu
                    </button>
                    <div class="dropdown-content" id="mainMenu">
                        <button class="dropdown-item" onclick="showSystemHelp(); closeMainMenu();">
                            Jak syst√©m funguje
                        </button>
                        <button class="dropdown-item" onclick="showDataProtection(); closeMainMenu();">
                            Ochrana dat
                        </button>
                        <button class="dropdown-item" onclick="refreshData(); closeMainMenu();">
                            Obnovit data
                        </button>
                        <button class="dropdown-item" onclick="runDiagnosticsManual(); closeMainMenu();">
                            Diagnostika
                        </button>
                        <button class="dropdown-item" onclick="toggleSettings(); closeMainMenu();">
                            Nastaven√≠
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="settings-panel" class="settings-panel" style="display: none;">
            <div class="settings-title">Nastaven√≠ syst√©mu</div>
            
            <!-- BLOK: AI MODELY -->
            <div class="settings-block">
                <div class="block-title">ü§ñ AI Modely</div>
                <div class="block-description">Vyberte a nastavte AI model pro komunikaci</div>
                
                <div class="settings-section">
                    <label>Zvolen√Ω AI model</label>
                    <select id="ai-model-select" onchange="toggleAIModelSettings()">
                        <option value="openai">OpenAI (ChatGPT)</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="claude">Anthropic Claude</option>
                    </select>
                    <small>Vyberte preferovan√Ω AI model pro komunikaci</small>
                </div>
                
                <!-- OpenAI nastaven√≠ -->
                <div id="openai-settings" class="ai-model-settings">
                    <div class="settings-section">
                        <label for="openai-key">OpenAI API kl√≠ƒç</label>
                        <div class="input-group">
                            <input type="password" id="openai-key" placeholder="sk-...">
                            <button onclick="toggleVisibility('openai-key')" class="toggle-btn">Zobrazit</button>
                        </div>
                        <small>Z√≠skejte na <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></small>
                    </div>
                </div>
                
                <!-- Gemini nastaven√≠ -->
                <div id="gemini-settings" class="ai-model-settings" style="display: none;">
                    <div class="settings-section">
                        <label for="gemini-key">Google Gemini API kl√≠ƒç</label>
                        <div class="input-group">
                            <input type="password" id="gemini-key" placeholder="AIza...">
                            <button onclick="toggleVisibility('gemini-key')" class="toggle-btn">Zobrazit</button>
                        </div>
                        <small>Z√≠skejte na <a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com</a></small>
                    </div>
                </div>
                
                <!-- Claude nastaven√≠ -->
                <div id="claude-settings" class="ai-model-settings" style="display: none;">
                    <div class="settings-section">
                        <label for="claude-key">Anthropic Claude API kl√≠ƒç</label>
                        <div class="input-group">
                            <input type="password" id="claude-key" placeholder="sk-ant-...">
                            <button onclick="toggleVisibility('claude-key')" class="toggle-btn">Zobrazit</button>
                        </div>
                        <small>Z√≠skejte na <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></small>
                    </div>
                </div>
            </div>
            
            <!-- BLOK: APLIKACE -->
            <div class="settings-block">
                <div class="block-title">üìä P≈ôipojen√© aplikace</div>
                <div class="block-description">Nastaven√≠ p≈ôipojen√≠ k va≈°im datov√Ωm zdroj≈Øm</div>
                
                <!-- Tabidoo -->
                <div class="app-connector">
                    <div class="app-connector-header">
                        <div class="app-connector-info">
                            <strong>Tabidoo CRM</strong>
                            <span class="app-connector-status" id="tabidoo-status">Nep≈ôipojeno</span>
                        </div>
                        <button class="app-connector-toggle" onclick="toggleAppConnector('tabidoo')">Nastavit</button>
                    </div>
                    
                    <div id="tabidoo-connector" class="app-connector-settings" style="display: none;">
                        <div class="settings-section">
                            <label for="tabidoo-app-id">App ID</label>
                            <input type="text" id="tabidoo-app-id" placeholder="CRM Start">
                            <small>N√°zev va≈°√≠ aplikace v Tabidoo</small>
                        </div>
                        
                        <div class="settings-section">
                            <label for="tabidoo-token">API Token</label>
                            <div class="input-group">
                                <input type="password" id="tabidoo-token" placeholder="eyJ...">
                                <button onclick="toggleVisibility('tabidoo-token')" class="toggle-btn">Zobrazit</button>
                            </div>
                            <small>Najdete v Tabidoo ‚Üí Nastaven√≠ ‚Üí API</small>
                        </div>
                    </div>
                </div>
                
                <!-- P≈ôipraveno pro dal≈°√≠ aplikace -->
                <div class="app-connector future-connector">
                    <div class="app-connector-header">
                        <div class="app-connector-info">
                            <strong>Dal≈°√≠ aplikace</strong>
                            <span class="app-connector-status">P≈ôipravujeme</span>
                        </div>
                        <button class="app-connector-toggle" disabled>Brzy</button>
                    </div>
                </div>
            </div>
            
            <!-- BLOK: OBECN√â NASTAVEN√ç -->
            <div class="settings-block">
                <div class="block-title">‚öôÔ∏è Obecn√© nastaven√≠</div>
                <div class="block-description">Vzhled a spr√°va konfigurace</div>
                
                <div class="settings-section">
                    <label>Barevn√© sch√©ma</label>
                    <div class="theme-selector">
                        <div class="theme-option theme-claude active" onclick="setAppTheme('claude')" title="Claude (v√Ωchoz√≠)"></div>
                        <div class="theme-option theme-google" onclick="setAppTheme('google')" title="Google"></div>
                        <div class="theme-option theme-replit" onclick="setAppTheme('replit')" title="Replit"></div>
                    </div>
                    <small>Vyberte barevn√© sch√©ma rozhran√≠</small>
                </div>
                
                <div class="settings-section">
                    <label>Spr√°va konfigurace</label>
                    <div class="config-actions">
                        <button onclick="exportConfig()" class="config-btn">
                            üì§ Export konfigurace
                        </button>
                        <button onclick="importConfig()" class="config-btn">
                            üì• Import konfigurace
                        </button>
                        <button onclick="startSetupWizard(); toggleSettings();" class="config-btn">
                            üßô‚Äç‚ôÇÔ∏è Pr≈Øvodce nastaven√≠m
                        </button>
                        <button onclick="clearAllData()" class="config-btn danger">
                            üóëÔ∏è Vymazat v≈°e
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="settings-actions">
                <button onclick="saveSettings()" class="primary-btn">Ulo≈æit nastaven√≠</button>
                <button onclick="toggleSettings()" class="secondary-btn">Zru≈°it</button>
            </div>
            
            <div class="security-info">
                V≈°echny API kl√≠ƒçe jsou ≈°ifrov√°ny a ukl√°d√°ny pouze lok√°lnƒõ ve va≈°em prohl√≠≈æeƒçi.
            </div>
        </div>
        
        <div id="embeddings-status" class="embeddings-status" style="display: none;">
            <span id="embeddings-text">Vytv√°≈ô√≠m vyhled√°vac√≠ index...</span>
            <div class="progress-bar">
                <div id="embeddings-progress" class="progress-fill"></div>
            </div>
        </div>
        
        <div id="chat-messages" class="chat-messages">
            <div class="welcome-container">
                <div class="example-queries" id="example-queries">
                    <!-- P≈ô√≠klady budou naƒçteny dynamicky -->
                </div>
            </div>
        </div>
        
        <div class="chat-input-area" id="chat-input-area">
            <textarea id="chat-input" class="chat-input" placeholder="Zeptejte se na cokoliv o va≈°ich datech..." rows="1"></textarea>
            <button id="send-button" class="send-button" onclick="sendMessage()">
                Odeslat
            </button>
        </div>
        
        <!-- NOV√Å PATIƒåKA -->
        <div class="app-footer">
            <div class="footer-content">
                <span class="footer-text">Powered by <a href="http://melioro.cz" target="_blank" rel="noopener noreferrer" class="footer-link"><strong>MELIORO Systems</strong></a></span>
                <span class="footer-domain">myconnectai.online</span>
            </div>
        </div>
    </div>

    <!-- Naƒçten√≠ POUZE existuj√≠c√≠ch skript≈Ø -->
    <script src="security.js"></script>
    <script src="config.js"></script>
    <script src="display.js"></script>
    <script src="data-loader.js"></script>
    <script src="local-search.js"></script>
    <script src="query-processor.js"></script>
    <script src="setup-wizard.js"></script>
    <script src="wizard-integration.js"></script>
    <script src="main.js"></script>
    
    <script>
        // === THEME MANAGEMENT ===
        function setAppTheme(theme) {
            document.body.classList.remove('theme-claude', 'theme-google', 'theme-replit');
            
            if (theme !== 'claude') {
                document.body.classList.add('theme-' + theme);
            }
            
            localStorage.setItem('selectedAppTheme', theme);
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            const activeOption = document.querySelector('.theme-' + theme);
            if (activeOption) {
                activeOption.classList.add('active');
            }
        }

        function loadAppTheme() {
            const savedTheme = localStorage.getItem('selectedAppTheme') || 'claude';
            setAppTheme(savedTheme);
        }

        // === MENU MANAGEMENT ===
        function toggleMainMenu() {
            const dropdown = document.getElementById('mainMenu');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        function closeMainMenu() {
            const dropdown = document.getElementById('mainMenu');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.matches('.menu-button') && !event.target.closest('.dropdown')) {
                const dropdowns = document.getElementsByClassName('dropdown-content');
                for (let dropdown of dropdowns) {
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                }
            }
        });

        // === AI MODEL MANAGEMENT ===
        function toggleAIModelSettings() {
            const selectedModel = document.getElementById('ai-model-select').value;
            
            // Skr√Ωt v≈°echna nastaven√≠ AI model≈Ø
            document.querySelectorAll('.ai-model-settings').forEach(settings => {
                settings.style.display = 'none';
            });
            
            // Zobrazit vybran√© nastaven√≠
            const selectedSettings = document.getElementById(selectedModel + '-settings');
            if (selectedSettings) {
                selectedSettings.style.display = 'block';
            }
            
            console.log('ü§ñ AI model changed to:', selectedModel);
        }
        
        // === APP CONNECTOR MANAGEMENT ===
        function toggleAppConnector(appName) {
            const connector = document.getElementById(appName + '-connector');
            const button = event.target;
            
            if (connector.style.display === 'none' || !connector.style.display) {
                connector.style.display = 'block';
                button.textContent = 'Skr√Ωt';
            } else {
                connector.style.display = 'none';
                button.textContent = 'Nastavit';
            }
        }
        
        function updateAppStatus(appName, status) {
            const statusElement = document.getElementById(appName + '-status');
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.className = 'app-connector-status ' + status.toLowerCase().replace(' ', '-');
            }
        }
        
        // === ENHANCED SAVE SETTINGS ===
        function saveSettings() {
            // Z√≠skat aktu√°ln√≠ AI model
            const selectedAIModel = document.getElementById('ai-model-select').value;
            
            // Ulo≈æit AI model preference
            localStorage.setItem('selected_ai_model', selectedAIModel);
            
            // Ulo≈æit API kl√≠ƒçe podle vybran√©ho modelu
            const openaiKey = document.getElementById('openai-key').value.trim();
            const geminiKey = document.getElementById('gemini-key').value.trim();
            const claudeKey = document.getElementById('claude-key').value.trim();
            
            if (openaiKey) {
                security.saveSecure('openai_key', openaiKey);
                APP_CONFIG.OPENAI_API_KEY = openaiKey;
            }
            if (geminiKey) {
                security.saveSecure('gemini_key', geminiKey);
                APP_CONFIG.GEMINI_API_KEY = geminiKey;
            }
            if (claudeKey) {
                security.saveSecure('claude_key', claudeKey);
                APP_CONFIG.CLAUDE_API_KEY = claudeKey;
            }
            
            // Ulo≈æit Tabidoo nastaven√≠
            const tabidooToken = document.getElementById('tabidoo-token').value.trim();
            const tabidooAppId = document.getElementById('tabidoo-app-id').value.trim();
            
            if (tabidooToken) {
                security.saveSecure('tabidoo_token', tabidooToken);
                APP_CONFIG.TABIDOO_API_TOKEN = tabidooToken;
                updateAppStatus('tabidoo', 'P≈ôipojeno');
            }
            
            if (tabidooAppId) {
                security.saveSecure('tabidoo_app_id', tabidooAppId);
                APP_CONFIG.TABIDOO_APP_ID = tabidooAppId;
            }
            
            console.log('üíæ Settings saved with AI model:', selectedAIModel);
            alert('Nastaven√≠ bezpeƒçnƒõ ulo≈æeno!');
            toggleSettings();
            
            // Reload pokud jsou pot≈ôeba nov√° data
            if (Object.keys(tablesData).length === 0 && APP_CONFIG.TABIDOO_API_TOKEN && APP_CONFIG.TABIDOO_APP_ID) {
                location.reload();
            }
        }
        
        // === ENHANCED TOGGLE SETTINGS ===
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            if (!panel) {
                console.error('Settings panel not found!');
                return;
            }
            
            const isHidden = panel.style.display === 'none' || !panel.style.display;
            
            if (isHidden) {
                panel.style.display = 'block';
                
                // Naƒç√≠st ulo≈æen√° nastaven√≠
                loadSettingsValues();
                
                // Zobrazit spr√°vn√Ω AI model
                setTimeout(() => {
                    toggleAIModelSettings();
                }, 50);
            } else {
                panel.style.display = 'none';
            }
        }
        
        // === LOAD SETTINGS VALUES ===
        function loadSettingsValues() {
            // Naƒç√≠st AI model preference
            const savedAIModel = localStorage.getItem('selected_ai_model') || 'openai';
            document.getElementById('ai-model-select').value = savedAIModel;
            
            // Naƒç√≠st API kl√≠ƒçe
            const openaiField = document.getElementById('openai-key');
            const geminiField = document.getElementById('gemini-key');
            const claudeField = document.getElementById('claude-key');
            const tabidooField = document.getElementById('tabidoo-token');
            const appIdField = document.getElementById('tabidoo-app-id');
            
            // Vyƒçistit v≈°echna pole
            openaiField.value = '';
            geminiField.value = '';
            claudeField.value = '';
            tabidooField.value = '';
            
            // Nastavit placeholdery
            openaiField.placeholder = APP_CONFIG.OPENAI_API_KEY ? 'API kl√≠ƒç je nastaven (pro zmƒõnu zadejte nov√Ω)' : 'sk-...';
            geminiField.placeholder = APP_CONFIG.GEMINI_API_KEY ? 'API kl√≠ƒç je nastaven (pro zmƒõnu zadejte nov√Ω)' : 'AIza...';
            claudeField.placeholder = APP_CONFIG.CLAUDE_API_KEY ? 'API kl√≠ƒç je nastaven (pro zmƒõnu zadejte nov√Ω)' : 'sk-ant-...';
            tabidooField.placeholder = APP_CONFIG.TABIDOO_API_TOKEN ? 'Token je nastaven (pro zmƒõnu zadejte nov√Ω)' : 'eyJ...';
            
            // App ID
            appIdField.value = APP_CONFIG.TABIDOO_APP_ID || '';
            
            // Aktualizovat status aplikac√≠
            if (APP_CONFIG.TABIDOO_API_TOKEN && APP_CONFIG.TABIDOO_APP_ID) {
                updateAppStatus('tabidoo', 'P≈ôipojeno');
            } else {
                updateAppStatus('tabidoo', 'Nep≈ôipojeno');
            }
        }
        function toggleVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            if (!field) return;
            
            const button = field.parentNode.querySelector('.toggle-btn');
            if (field.type === 'password') {
                field.type = 'text';
                if (button) button.textContent = 'Skr√Ωt';
            } else {
                field.type = 'password';
                if (button) button.textContent = 'Zobrazit';
            }
        }
        
        // Enhanced toggleSettings to ensure footer buttons are added
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            if (!panel) {
                console.error('Settings panel not found!');
                return;
            }
            
            const isHidden = panel.style.display === 'none' || !panel.style.display;
            
            if (isHidden) {
                panel.style.display = 'block';
                
                // FORCE create footer buttons every time settings open
                setTimeout(() => {
                    forceCreateSettingsFooter();
                }, 50);
            } else {
                panel.style.display = 'none';
            }
        }
        
        // Function to FORCE create settings footer buttons
        function forceCreateSettingsFooter() {
            const panel = document.getElementById('settings-panel');
            if (!panel) return;
            
            // Remove existing footer if it exists
            let existingFooter = panel.querySelector('.settings-footer');
            if (existingFooter) {
                existingFooter.remove();
            }
            
            // Find security info or create insertion point
            let securityInfo = panel.querySelector('.security-info');
            
            // Create new footer
            const footer = document.createElement('div');
            footer.className = 'settings-footer';
            footer.innerHTML = `
                <button onclick="startSetupWizard(); toggleSettings();" class="link-btn">Nastaven√≠ nov√© aplikace</button>
                <button onclick="exportConfig()" class="link-btn">Export konfigurace</button>
                <button onclick="importConfig()" class="link-btn">Import konfigurace</button>
                <button onclick="clearAllData()" class="link-btn danger">Vymazat v≈°e</button>
            `;
            
            if (securityInfo) {
                // Insert before security info
                securityInfo.parentNode.insertBefore(footer, securityInfo);
            } else {
                // Just append to panel
                panel.appendChild(footer);
                
                // Also create security info if it doesn't exist
                const securityDiv = document.createElement('div');
                securityDiv.className = 'security-info';
                securityDiv.textContent = 'V≈°echny API kl√≠ƒçe jsou ≈°ifrov√°ny a ukl√°d√°ny pouze lok√°lnƒõ ve va≈°em prohl√≠≈æeƒçi.';
                panel.appendChild(securityDiv);
            }
            
            console.log('üîß Settings footer forcefully created');
        }
        
        // Override toggleSettings globally IMMEDIATELY
        window.toggleSettings = toggleSettings;
        
        function clearAllData() {
            if (confirm('Opravdu chcete vymazat v≈°echna data vƒçetnƒõ API kl√≠ƒç≈Ø?\n\nTato akce je nevratn√°!')) {
                localStorage.clear();
                alert('V≈°echna data byla vymaz√°na.');
                location.reload();
            }
        }
        
        function runDiagnosticsManual() {
            if (typeof CONFIG !== 'undefined' && CONFIG.CACHE && CONFIG.CACHE.DIAGNOSTICS_KEY) {
                localStorage.removeItem(CONFIG.CACHE.DIAGNOSTICS_KEY);
            }
            location.reload();
        }
        
        // === EXAMPLE QUERIES ===
        function loadExampleQueries() {
            const exampleQueriesContainer = document.getElementById('example-queries');
            if (!exampleQueriesContainer) return;
            
            let examples = [];
            if (typeof CONFIG !== 'undefined' && CONFIG.EXAMPLE_QUERIES) {
                examples = CONFIG.EXAMPLE_QUERIES;
            } else {
                examples = [
                    { text: 'Kolik firem je v syst√©mu?' },
                    { text: 'Vypi≈° v≈°echny firmy' },
                    { text: 'Najdi firmu Alza' },
                    { text: 'Kolik kontakt≈Ø m√°me?' },
                    { text: 'Vypi≈° obchodn√≠ p≈ô√≠pady' },
                    { text: 'Kolik aktivit probƒõhlo?' }
                ];
            }
            
            exampleQueriesContainer.innerHTML = examples.map(example => `
                <div class="example-query" onclick="clickExampleQuery('${example.text.replace(/'/g, "\\'")}')">
                    ${example.text}
                </div>
            `).join('');
        }
        
        function clickExampleQuery(query) {
            const chatInput = document.getElementById('chat-input');
            if (!chatInput) return;
            
            chatInput.value = query;
            chatInput.focus();
            
            chatInput.style.height = 'auto';
            chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
            
            if (typeof hideWelcomeScreen === 'function') {
                hideWelcomeScreen();
            }
        }
        
        // === AUTO-RESIZE TEXTAREA ===
        function setupAutoResize() {
            const chatInput = document.getElementById('chat-input');
            if (!chatInput) return;
            
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
            
            chatInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    if (typeof sendMessage === 'function') {
                        sendMessage();
                    }
                }
            });
        }
        
        // === ENHANCED SYSTEM HELP ===
        function showSystemHelp() {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) return;
            
            const helpContent = `
                <div class="system-help">
                    <div class="help-header">
                        <h3>Jak syst√©m funguje</h3>
                        <button class="help-close-btn" onclick="showWelcomeScreen()">&times;</button>
                    </div>
                    
                    <div class="help-content">
                        <div class="help-section">
                            <h4>Hybridn√≠ AI Connect p≈ô√≠stup</h4>
                            <p>Kombinuje rychl√© lok√°ln√≠ vyhled√°v√°n√≠ s inteligentn√≠ AI komunikac√≠. 
                            Va≈°e data zpracov√°v√°m lok√°lnƒõ pro rychlost a p≈ôesnost, ChatGPT pou≈æ√≠v√°m jen pro formulaci odpovƒõd√≠.</p>
                        </div>
                        
                        <div class="help-section">
                            <h4>Kl√≠ƒçov√© v√Ωhody</h4>
                            <ul class="help-list">
                                <li>Okam≈æit√© odpovƒõdi bez ƒçek√°n√≠ na API</li>
                                <li>100% p≈ôesnost p≈ôi poƒç√≠t√°n√≠ z√°znam≈Ø</li>
                                <li>Inteligentn√≠ rozpozn√°v√°n√≠ r≈Øzn√Ωch tvar≈Ø slov</li>
                                <li>Chytr√© vyhled√°v√°n√≠ nez√°visl√© na velikosti p√≠smen</li>
                            </ul>
                        </div>
                        
                        <div class="help-section">
                            <h4>Co um√≠m</h4>
                            <ul class="help-list">
                                <li>Poƒç√≠tat z√°znamy - "Kolik firem m√°me?"</li>
                                <li>Vypisovat seznamy - "Vypi≈° v≈°echny kontakty"</li>
                                <li>Vyhled√°vat konkr√©tn√≠ z√°znamy - "Najdi firmu XYZ"</li>
                                <li>Naj√≠t souvisej√≠c√≠ informace - "Jak√© aktivity m√° firma ABC?"</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.innerHTML = helpContent;
        }
        
        // === DATA PROTECTION INFO ===
        function showDataProtection() {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) return;
            
            const dataProtectionContent = `
                <div class="system-help">
                    <div class="help-header">
                        <h3>üîí Ochrana dat a soukrom√≠</h3>
                        <button class="help-close-btn" onclick="showWelcomeScreen()">&times;</button>
                    </div>
                    
                    <div class="help-content">
                        <div class="help-section">
                            <h4>üõ°Ô∏è GDPR Compliance</h4>
                            <p>My Connect AI je plnƒõ v souladu s na≈ô√≠zen√≠m GDPR. Va≈°e osobn√≠ data jsou chr√°nƒõna podle nejvy≈°≈°√≠ch evropsk√Ωch standard≈Ø a m√°te plnou kontrolu nad jejich zpracov√°n√≠m.</p>
                        </div>
                        
                        <div class="help-section">
                            <h4>üîê Zabezpeƒçen√≠ dat</h4>
                            <ul class="help-list">
                                <li><strong>Lok√°ln√≠ ≈°ifrov√°n√≠:</strong> API kl√≠ƒçe jsou ≈°ifrov√°ny a ulo≈æeny pouze ve va≈°em prohl√≠≈æeƒçi</li>
                                <li><strong>≈Ω√°dn√© sledov√°n√≠:</strong> Neukl√°d√°me ≈æ√°dn√© osobn√≠ √∫daje na na≈°ich serverech</li>
                                <li><strong>P≈ô√≠m√© p≈ôipojen√≠:</strong> Komunikujeme p≈ô√≠mo s Tabidoo a OpenAI API</li>
                                <li><strong>Transparentnost:</strong> Ve≈°ker√Ω k√≥d je open source a kontrolovateln√Ω</li>
                            </ul>
                        </div>
                        
                        <div class="help-section">
                            <h4>üë§ Va≈°e pr√°va</h4>
                            <ul class="help-list">
                                <li><strong>Pln√° kontrola:</strong> Kdykoliv m≈Ø≈æete smazat v≈°echna sv√° data</li>
                                <li><strong>Export dat:</strong> M≈Ø≈æete exportovat svou konfiguraci</li>
                                <li><strong>Anonymita:</strong> Nepot≈ôebujeme ≈æ√°dnou registraci ani osobn√≠ √∫daje</li>
                                <li><strong>Odej√≠t kdykoliv:</strong> ≈Ω√°dn√© z√°vazky nebo p≈ôedplatn√©</li>
                            </ul>
                        </div>
                        
                        <div class="help-section">
                            <h4>üè¢ Zpracov√°n√≠ firemn√≠ch dat</h4>
                            <ul class="help-list">
                                <li><strong>Lok√°ln√≠ zpracov√°n√≠:</strong> Ve≈°ker√° anal√Ωza prob√≠h√° ve va≈°em prohl√≠≈æeƒçi</li>
                                <li><strong>Bez ukl√°d√°n√≠:</strong> Neukl√°d√°me kopie va≈°ich Tabidoo dat</li>
                                <li><strong>≈†ifrovan√° komunikace:</strong> Ve≈°ker√° komunikace prob√≠h√° p≈ôes HTTPS</li>
                                <li><strong>Audit trail:</strong> V≈°echny akce jsou protokolov√°ny pro bezpeƒçnost</li>
                            </ul>
                        </div>
                        
                        <div class="help-section">
                            <h4>üåç Mezin√°rodn√≠ standardy</h4>
                            <p>Syst√©m My Connect AI dodr≈æuje mezin√°rodn√≠ standardy pro ochranu dat vƒçetnƒõ GDPR (EU), CCPA (California), a dal≈°√≠ch region√°ln√≠ch p≈ôedpis≈Ø. Va≈°e data nikdy neopust√≠ v√°≈° prohl√≠≈æeƒç bez va≈°eho v√Ωslovn√©ho souhlasu.</p>
                        </div>
                        
                        <div class="help-section">
                            <h4>üìû Kontakt a podpora</h4>
                            <p>V p≈ô√≠padƒõ dotaz≈Ø ohlednƒõ ochrany dat n√°s kontaktujte na: <strong>privacy@melioro.cz</strong></p>
                            <p>Reakce do 24 hodin ‚Ä¢ ƒåesk√° podpora ‚Ä¢ Odborn√© poradenstv√≠</p>
                        </div>
                    </div>
                    
                    <div class="help-footer" style="background: var(--surface); padding: 1rem 2rem; border-top: 1px solid var(--border); text-align: center;">
                        <p style="margin: 0; font-size: 0.875rem; color: var(--text-secondary);">
                            <strong>My Connect AI</strong> - Bezpeƒçn√Ω, transparentn√≠ a v souladu s GDPR
                        </p>
                    </div>
                </div>
            `;
            
            chatMessages.innerHTML = dataProtectionContent;
        }
        
        // === ENHANCED WIZARD FUNCTIONS ===
        
        // Override startSetupWizard to add cancel functionality and close settings
        function createStartSetupWizardWrapper() {
            const originalStartSetupWizard = window.startSetupWizard;
            
            window.startSetupWizard = function() {
                console.log('üßô‚Äç‚ôÇÔ∏è Starting wizard with settings closure');
                
                // FORCE close settings panel
                const settingsPanel = document.getElementById('settings-panel');
                if (settingsPanel) {
                    settingsPanel.style.display = 'none';
                    console.log('Settings panel closed');
                }
                
                // Store reference that wizard was started from settings
                sessionStorage.setItem('wizardStartedFromSettings', 'true');
                
                // Call original function if exists
                if (originalStartSetupWizard && typeof originalStartSetupWizard === 'function') {
                    return originalStartSetupWizard();
                } else if (typeof setupWizard !== 'undefined' && setupWizard.start) {
                    return setupWizard.start();
                } else {
                    console.error('Setup wizard not available');
                    alert('Pr≈Øvodce nastaven√≠m nen√≠ dostupn√Ω. Zkuste obnovit str√°nku.');
                }
            };
        }
        
        // Apply wrapper immediately and after delay
        createStartSetupWizardWrapper();
        setTimeout(createStartSetupWizardWrapper, 2000);
        setTimeout(createStartSetupWizardWrapper, 5000);
        
        // Add cancel wizard function
        function cancelSetupWizard() {
            if (confirm('Opravdu chcete zru≈°it pr≈Øvodce nastaven√≠m?')) {
                sessionStorage.removeItem('wizardStartedFromSettings');
                // Return to normal state
                if (typeof showWelcomeScreen === 'function') {
                    showWelcomeScreen();
                } else {
                    location.reload();
                }
            }
        }
        
        // Make cancel function globally available
        window.cancelSetupWizard = cancelSetupWizard;
        
        // === INTEGRATION WITH EXISTING SYSTEM ===
        
        // FORCE override showWelcomeScreen AFTER all scripts load
        function forceCorrectWelcomeScreen() {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) return;
            
            chatMessages.innerHTML = `
                <div class="welcome-container">
                    <div class="example-queries" id="example-queries">
                        <!-- P≈ô√≠klady budou naƒçteny dynamicky -->
                    </div>
                </div>
            `;
            
            // Load example queries immediately
            loadExampleQueries();
        }
        
        // Override the function MULTIPLE times to ensure it sticks
        window.showWelcomeScreen = forceCorrectWelcomeScreen;
        
        // Watch for any attempts to change welcome screen content
        let welcomeObserver;
        function startWelcomeScreenProtection() {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) return;
            
            // Disconnect existing observer
            if (welcomeObserver) {
                welcomeObserver.disconnect();
            }
            
            // Create new observer to watch for unwanted changes
            welcomeObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        const welcomeContainer = chatMessages.querySelector('.welcome-container');
                        if (welcomeContainer) {
                            // Check if unwanted buttons were added
                            const actionButtons = welcomeContainer.querySelector('.welcome-actions, .help-btn, .examples-btn');
                            if (actionButtons) {
                                console.log('üõ°Ô∏è Blocking unwanted welcome buttons');
                                forceCorrectWelcomeScreen();
                            }
                        }
                    }
                });
            });
            
            welcomeObserver.observe(chatMessages, {
                childList: true,
                subtree: true
            });
        }
        
        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé® Enhanced UI initializing...');
            
            loadAppTheme();
            setupAutoResize();
            
            // Override toggleSettings immediately
            window.toggleSettings = toggleSettings;
            
            // Start protection and force correct welcome screen
            setTimeout(() => {
                startWelcomeScreenProtection();
                forceCorrectWelcomeScreen();
            }, 100);
            
            console.log('üé® Enhanced UI ready');
        });
        
        // Fallback for already loaded DOM
        if (document.readyState !== 'loading') {
            setTimeout(() => {
                loadAppTheme();
                setupAutoResize();
                window.toggleSettings = toggleSettings;
                startWelcomeScreenProtection();
                forceCorrectWelcomeScreen();
            }, 200);
        }
        
        // ALSO override toggleSettings after all scripts load
        setTimeout(() => {
            window.toggleSettings = toggleSettings;
            console.log('üîß toggleSettings override applied');
        }, 3000);
        
        // AGGRESSIVE override - keep overriding the function every 100ms for 2 seconds
        let overrideAttempts = 0;
        const maxOverrideAttempts = 20;
        
        const overrideInterval = setInterval(() => {
            if (overrideAttempts >= maxOverrideAttempts) {
                clearInterval(overrideInterval);
                return;
            }
            
            window.showWelcomeScreen = forceCorrectWelcomeScreen;
            window.loadExampleQueries = loadExampleQueries;
            overrideAttempts++;
            
            // Also force correct display if chat-messages exists
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages && chatMessages.innerHTML.includes('welcome-actions')) {
                console.log('üõ°Ô∏è Detected unwanted buttons, forcing correct display');
                forceCorrectWelcomeScreen();
            }
        }, 100);
        
        // === COMPATIBILITY CHECKS ===
        setTimeout(() => {
            const requiredFunctions = [
                'sendMessage', 'saveSettings', 
                'refreshData', 'startSetupWizard', 'exportConfig', 
                'importConfig'
            ];
            
            const missingFunctions = requiredFunctions.filter(fn => typeof window[fn] !== 'function');
            
            if (missingFunctions.length > 0) {
                console.warn('‚ö†Ô∏è Missing functions:', missingFunctions);
            } else {
                console.log('‚úÖ All required functions available');
            }
            
            if (typeof CONFIG === 'undefined') {
                console.warn('‚ö†Ô∏è CONFIG object not found');
            } else {
                console.log('‚úÖ CONFIG loaded');
            }
            
            // Check current state
            const settingsPanel = document.getElementById('settings-panel');
            if (settingsPanel) {
                console.log('‚úÖ Settings panel found');
                console.log('üí° To see footer buttons, click "Nastaven√≠" in the menu');
            } else {
                console.warn('‚ö†Ô∏è Settings panel not found');
            }
            
            // Confirm toggleSettings override
            if (window.toggleSettings === toggleSettings) {
                console.log('‚úÖ toggleSettings successfully overridden');
            } else {
                console.warn('‚ö†Ô∏è toggleSettings override failed, trying again...');
                window.toggleSettings = toggleSettings;
            }
        }, 4000); // Wait even longer for all scripts to load
    </script>
</body>
</html>
