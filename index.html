<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabidoo ChatGPT Asistent</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Tabidoo ChatGPT Asistent</h1>
            <div class="header-buttons">
                <button class="refresh-button" onclick="refreshData()" title="Obnovit data z Tabidoo">🔄</button>
                <button class="settings-button" onclick="toggleSettings()" title="Nastavení">⚙️</button>
                <button class="diagnostic-button" onclick="runDiagnosticsManual()" title="Diagnostika">🔧</button>
            </div>
        </div>
        
        <div id="settings-panel" class="settings-panel" style="display: none;">
            <h3>🔐 Zabezpečené nastavení API</h3>
            
            <div class="settings-section">
                <label for="openai-key">OpenAI API klíč:</label>
                <div class="input-group">
                    <input type="password" id="openai-key" placeholder="sk-...">
                    <button onclick="toggleVisibility('openai-key')" class="toggle-btn">👁️</button>
                </div>
                <small>Získejte na <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></small>
            </div>
            
            <div class="settings-section">
                <label for="tabidoo-token">Tabidoo API token:</label>
                <div class="input-group">
                    <input type="password" id="tabidoo-token" placeholder="eyJ...">
                    <button onclick="toggleVisibility('tabidoo-token')" class="toggle-btn">👁️</button>
                </div>
                <small>Najdete v Tabidoo → Nastavení → API</small>
            </div>
            
            <div class="settings-section">
                <label for="tabidoo-app-id">Tabidoo App ID:</label>
                <input type="text" id="tabidoo-app-id" placeholder="CRM Start">
                <small>Název vaší aplikace v Tabidoo</small>
            </div>
            
            <div class="settings-actions">
                <button onclick="saveSettings()" class="primary-btn">💾 Uložit nastavení</button>
                <button onclick="toggleSettings()" class="secondary-btn">Zrušit</button>
            </div>
            
            <div class="settings-footer">
                <button onclick="exportConfig()" class="link-btn">📤 Export konfigurace</button>
                <button onclick="importConfig()" class="link-btn">📥 Import konfigurace</button>
                <button onclick="clearAllData()" class="link-btn danger">🗑️ Vymazat vše</button>
            </div>
            
            <div class="security-info">
                🔒 Všechny API klíče jsou šifrovány a ukládány pouze lokálně ve vašem prohlížeči.
            </div>
        </div>
        
        <div id="embeddings-status" class="embeddings-status" style="display: none;">
            <span id="embeddings-text">Vytvářím vyhledávací index...</span>
            <div class="progress-bar">
                <div id="embeddings-progress" class="progress-fill"></div>
            </div>
        </div>
        
        <div id="chat-messages" class="chat-messages">
            <div class="message system-message">
                Načítám systém...
            </div>
        </div>
        
        <div class="chat-input-area">
            <textarea id="chat-input" class="chat-input" placeholder="Napište vaši zprávu..." rows="2"></textarea>
            <button id="send-button" class="send-button" onclick="sendMessage()">Odeslat</button>
        </div>
    </div>

    <!-- Načtení všech skriptů ve správném pořadí -->
    <script src="security.js"></script>
    <script src="config.js"></script>
    <script src="embeddings.js"></script>
    <script src="display.js"></script>
    <script src="data-loader.js"></script>
    <script src="analytics.js"></script>
    <script src="search.js"></script>
    <script src="ai-handler.js"></script>
    <script src="init.js"></script>
    <script src="query-processor.js"></script>
    <script src="local-search.js"></script>
    <script src="main.js"></script>
    
    <script>
        // Pomocné funkce
        function toggleVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            field.type = field.type === 'password' ? 'text' : 'password';
        }
        
        function clearAllData() {
            if (confirm('Opravdu chcete vymazat všechna data včetně API klíčů?\n\nTato akce je nevratná!')) {
                localStorage.clear();
                alert('Všechna data byla vymazána.');
                location.reload();
            }
        }
        
        // Manuální spuštění diagnostiky
        function runDiagnosticsManual() {
            localStorage.removeItem(CONFIG.CACHE.DIAGNOSTICS_KEY);
            location.reload();
        }
    </script>
</body>
</html>
